<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{ name }} â€” OSRS GE Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: #0b0b0b;
            color: #f0d070;
            font-family: sans-serif;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: #2a1a0f;
            padding: 20px;
            border-radius: 12px;
        }
        h1 {
            font-size: 24px;
            color: #ffcc66;
        }
        canvas {
            background: #fff;
            border-radius: 8px;
            margin-top: 20px;
        }
        .description {
            margin-top: 20px;
            padding: 10px;
            background: #1e1208;
            border-radius: 8px;
            font-size: 14px;
        }
        .timeframe-buttons {
            margin-top: 10px;
        }
        .timeframe-buttons button {
            margin-right: 8px;
            padding: 6px 12px;
            background: #503820;
            color: #f0d070;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>{{ name }}</h1>
        <div class="timeframe-buttons">
            <button onclick="loadData('1h')">1 Hour</button>
            <button onclick="loadData('24h')">24 Hours</button>
            <button onclick="loadData('7d')">7 Days</button>
            <button onclick="loadData('30d')">30 Days</button>
            <button onclick="loadData('1y')">1 Year</button>
            <button onclick="loadData('all')">All</button>
        </div>
        <canvas id="priceChart" width="800" height="400"></canvas>
        <div class="description">
            <strong>Description:</strong><br>
            {{ description }}
        </div>
    </div>

    <script>
        const ctx = document.getElementById("priceChart").getContext("2d");
        let chart = new Chart(ctx, {
            type: "line",
            data: {
                labels: [],
                datasets: [
                    {
                        label: "Buy Price",
                        data: [],
                        borderColor: "#66cc66",
                        fill: false
                    },
                    {
                        label: "Sell Price",
                        data: [],
                        borderColor: "#cc6666",
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    x: { display: true, title: { display: true, text: "Time" } },
                    y: { display: true, title: { display: true, text: "Price (gp)" } }
                }
            }
        });

        async function loadData(timeframe = "7d") {
            const res = await fetch(`/api/item/{{ item_id }}/history?timeframe=${timeframe}`);
            const json = await res.json();
            const labels = json.data.map(d => new Date(d.ts * 1000).toLocaleString());
            const buy = json.data.map(d => d.buy);
            const sell = json.data.map(d => d.sell);
            chart.data.labels = labels;
            chart.data.datasets[0].data = buy;
            chart.data.datasets[1].data = sell;
            chart.update();
        }

        loadData(); // Load default 7d
    </script>
</body>
</html>
